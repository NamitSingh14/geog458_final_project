<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>Weather information in the contiguous USA</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet" />
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.css" rel="stylesheet" />
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.js"></script>
  <link rel="stylesheet" href="css/map1.css" />
  <link rel="stylesheet" href="css/index.css" />
</head>

<body>
  <div class="topnav">
    <a href="index.html">Home</a>
    <a href="map1.html">Average Temperature Map</a>
    <a href="map1.html">Map 2</a>
    <a href="data.html">Data</a>
  </div>

  <div id="map-wrapper">
    <div id="map"></div>

    <div id="menu">
      Select data type to visualize:
      <input id="avg-temp" type="radio" name="rtoggle" value="avg_temp" checked="checked" />
      <label for="avg-temp">Average Temperature</label>
      <input id="max-temp" type="radio" name="rtoggle" value="max_temp" />
      <label for="max-temp">Max Temperature</label>
      <input id="min-temp" type="radio" name="rtoggle" value="min_temp" />
      <label for="min-temp">Min Temperature</label>
      <input id="precipitation" type="radio" name="rtoggle" value="precipitation" />
      <label for="precipitation">Precipitation</label>
    </div>

    <div class="map-overlay top">
      <div class="map-overlay-inner">
        <h2>
          Select year and month to display the corresponding weather data
        </h2>
        <label id="year">2000</label>
        <input class="slider" id="slider year" type="range" min="0" max="15" step="1" value="0"
          onchange="updateSliderYear(this.value)" />
        <label id="month">January</label>
        <input class="slider" id="slider month" type="range" min="0" max="11" step="1" value="0"
          onchange="updateSliderMonth(this.value)" />
      </div>
    </div>
    <div id="features">
      <h2>Climate Division Details</h2>
      <div id="pd">
        <p>Hover over a division!</p>
      </div>
    </div>
    <div id="legend">Legend (in Fahrenheit)</div>

    <div id="title">Weather information in the contiguous USA</div>
    <div id="subtitle">May 21, 2022</div>
  </div>
  <script>
    mapboxgl.accessToken =
      "pk.eyJ1IjoiamFrb2J6aGFvIiwiYSI6ImNpcms2YWsyMzAwMmtmbG5icTFxZ3ZkdncifQ.P9MBej1xacybKcDN_jehvw";
    let map = new mapboxgl.Map({
      container: "map", // container ID
      style: "mapbox://styles/mapbox/dark-v10",
      zoom: 4.5, // starting zoom
      center: [-100, 40], // starting center
    });

    map.setProjection("albers");

    const years = [
      2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011,
      2012, 2013, 2014, 2015,
    ];

    const months = [
      "january",
      "february",
      "march",
      "april",
      "may",
      "june",
      "july",
      "august",
      "september",
      "october",
      "november",
      "december",
    ];

    let temp = "january";

    function updateSliderYear(slideAmount) {
      var sliderDiv = document.getElementById("year");
      const filters = ["==", "year", years[slideAmount]];
      map.setFilter("data-layer", filters);
      sliderDiv.innerHTML = years[slideAmount];
    }

    //load data to the map as new layers.
    //map.on('load', function loadingData() {
    map.on("load", () => {
      // Add a source for the county polygons.
      map.addSource("states", {
        type: "geojson",
        data: "assets/json/avg_temp_poly.geojson",
      });

      map.addLayer({
        id: "data-layer",
        type: "fill",
        source: "states",
        minzoom: 2,
        paint: {
          "fill-color": [
            "step",
            ["get", temp],
            "#00c0ff",
            0,
            "#2bb6ff",
            10,
            "#5caaff",
            20,
            "#8a9aff",
            30,
            "#b585ff",
            40,
            "#d96de9",
            50,
            "#f64dc9",
            60,
            "#ff22a1",
            70,
            "#ff0074",
            80,
            "#ff0043",
            90,
            "#fe0000",
          ],
          "fill-outline-color": "#BBBBBB",
          "fill-opacity": 0.7,
        },
      });

      map.on("mousemove", (event) => {
        const states = map.queryRenderedFeatures(event.point, {
          layers: ["data-layer"],
        });
        document.getElementById("pd").innerHTML = states.length
          ? `<h3>State: ${states[0].properties.state}</h3>
            <p><strong><em>Division: ${states[0].properties.name
          }</strong></em></p>
            Temperature: ${states[0].properties[temp]}F / ${(
            (states[0].properties[temp] - 32) /
            1.8
          ).toFixed(2)}C`
          : `<p>Hover over a division!</p>`;
      });
    });

    function updateSliderMonth(slideAmount) {
      var sliderDiv = document.getElementById("month");
      sliderDiv.innerHTML =
        months[slideAmount].charAt(0).toUpperCase() +
        months[slideAmount].substring(1);
      temp = months[slideAmount];

      map.setPaintProperty("data-layer", "fill-color", [
        "step",
        ["get", temp],
        "#00c0ff",
        0,
        "#2bb6ff",
        10,
        "#5caaff",
        20,
        "#8a9aff",
        30,
        "#b585ff",
        40,
        "#d96de9",
        50,
        "#f64dc9",
        60,
        "#ff22a1",
        70,
        "#ff0074",
        80,
        "#ff0043",
        90,
        "#fe0000",
      ]);
    }

    const layers = [
      "0-10",
      "11-20",
      "21-30",
      "31-40",
      "41-50",
      "51-60",
      "61-70",
      "81-90",
      "91+",
    ];
    const colors = [
      "#00c0ff",
      "#2bb6ff",
      "#5caaff",
      "#8a9aff",
      "#b585ff",
      "#d96de9",
      "#f64dc9",
      "#ff22a1",
      "#ff0074",
      "#ff0043",
      "#fe0000",
    ];

    const legend = document.getElementById("legend");

    layers.forEach((layer, i) => {
      const color = colors[i];
      const item = document.createElement("div");
      const key = document.createElement("span");
      key.className = "legend-key";
      key.style.backgroundColor = color;

      const value = document.createElement("span");
      value.innerHTML = `${layer}`;
      item.appendChild(key);
      item.appendChild(value);
      legend.appendChild(item);
    });

    const layerList = document.getElementById("menu");
    const inputs = layerList.getElementsByTagName("input");
    
    for (const input of inputs) {
      input.onclick = (layer) => {
        const geojsonSource = map.getSource('states');
        console.log(layer);
        const layerId = layer.target.id;

        switch (layerId) {
          case "avg-temp":
            console.log(geojsonSource);
            geojsonSource.setData("assets/json/avg_temp_poly.geojson");
            break;

          case "min-temp":
            geojsonSource.setData("assets/json/min_temp_poly.geojson");
            break;

          case "max-temp":
            geojsonSource.setData("assets/json/max_temp_poly.geojson");
            break;

          case "precipitation":
            geojsonSource.setData("assets/json/precipitation_poly.geojson");
            break;

          default:
            break;
        }
      };
    }
  </script>
</body>

</html>